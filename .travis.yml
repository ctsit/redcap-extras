language: python
python: '2.7'
sudo: required

branches:
    only:
        - /^feature.*$/
        - /^redcap.*$/
        - develop
        - master
env:
  global:
    - secure: RAzBBv5Ac7AcoRR4YAps38WEGeYzv3F/6UEIdhcE50JALSE27rrEgUHrw/lCLcJUpBHicw4tfS9e9lNB0MQwDvOt0KHGTHdEjKl4+qzqZ68H6WaZFuKh/t98gvvNEccR/ay47KLt+gs9B9Obc7nTTFQx2aiIgb7aW759cyDeldk=
    - secure: V9mQSU2iQCDvo1yXieThEMXWT3Cx1vZYAjxxHAtOdIwiyWRsi33lP3XaZmzRdIdEVL3//RjWOeusdfhs/u0jH2KorCvPEneyR3Q53yg9ni9CpiX60vM/i31jf+sRHL1DQ+fnIyqs5vQZWXApRW4eQ8FuEBEq/ie+c7VdZvbmfQA=
    - CI_REDCAP_ZIP=releases-lts/redcap6.5.3.zip SHARED_FOLDER=./vagrant
    - CI_REDCAP_ZIP=releases-lts/redcap6.5.9.zip SHARED_FOLDER=./vagrant
    - CI_REDCAP_ZIP=releases-standard/redcap6.8.0.zip SHARED_FOLDER=./vagrant
addons:
  sauce_connect:
    username: ctsit
    access_key:
      secure: V9mQSU2iQCDvo1yXieThEMXWT3Cx1vZYAjxxHAtOdIwiyWRsi33lP3XaZmzRdIdEVL3//RjWOeusdfhs/u0jH2KorCvPEneyR3Q53yg9ni9CpiX60vM/i31jf+sRHL1DQ+fnIyqs5vQZWXApRW4eQ8FuEBEq/ie+c7VdZvbmfQA=
before_install:
    - ./vagrant/travis-before-install.sh
install:
    - sudo -E ./vagrant/bootstrap.sh
    - phantomjs --version
    - pip install selenium
    - pip freeze | grep selenium
    - apachectl -V
script:
    - curl -s http://localhost/redcap/ | grep -i 'Welcome\|Critical Error'
    - ls /var/www/redcap/
    - python tests/test_redcap_hooks.py
# after_failure:
    # - curl -T screenshot-test_redcap_hooks.png http://taeber.rapczak.com/ctsit/test_redcap_hooks.php

#addons:
#    apt:
#        packages:
#            - apache2
#            - mysql-server
#            - php5
#            - php-pear
#            - php5-mysql
#            - php5-curl
